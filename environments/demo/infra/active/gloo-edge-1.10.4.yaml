apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: gloo-edge-enterprise-helm
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    namespace: gloo-system
    server: https://kubernetes.default.svc
  project: default
  source:
    chart: gloo-ee
    helm:
      skipCrds: true
      values: |
        create_license_secret: false
        gloo:
          license_secret_name: license
        gloo-fed:
          enabled: false
          create_license_secret: false
          glooFedApiserver:
            enable: false
        gloo:
          gateway:
            validation:
              warnRouteShortCircuiting: true
          gatewayProxies:
            gatewayProxy:
              gatewaySettings:
                accessLoggingService:
                  accessLog:
                    - fileSink:
                        path: /dev/stdout
                        stringFormat: >
                          [%START_TIME%] "%REQ(X-ENVOY-ORIGINAL-METHOD?:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%"
                          %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION%
                          %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% "%REQ(X-FORWARDED-FOR)%" "%REQ(USER-AGENT)%"
                          "%REQ(X-REQUEST-ID)%" "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%" "%ROUTE_NAME%"
    repoURL: http://storage.googleapis.com/gloo-ee-helm
    targetRevision: 1.10.4
  syncPolicy:
    automated:
      prune: true # Specifies if resources should be pruned during auto-syncing ( false by default ).
      selfHeal: true # Specifies if partial app sync should be executed when resources are changed only in target Kubernetes cluster and no git change detected ( false by default ).
    syncOptions:
      - CreateNamespace=true
